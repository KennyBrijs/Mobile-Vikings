// Generated by CoffeeScript 1.3.3
(function() {
  var Map, isValidEmail, map, scrollTo, showEmailError, showUserPosition;

  map = null;

  $(function() {
    if (localStorage.email != null) {
      $("input#email").val(localStorage.email);
    }
    $('[href^="#"]').click(scrollTo);
    map = new Map();
    map.createMap();
    map.addMarker(50.94958, 5.34657);
    if (navigator.geolocation != null) {
      return navigator.geolocation.getCurrentPosition(showUserPosition);
    }
  });

  Map = (function() {

    function Map() {}

    Map.prototype.map = null;

    Map.prototype.latitude = 50.94958;

    Map.prototype.longitude = 5.34657;

    Map.prototype.zoom = 7;

    Map.prototype.maxZoom = 18;

    Map.prototype.createMap = function() {
      this.map = L.map('map').setView([this.latitude, this.longitude], this.zoom);
      return L.tileLayer('http://{s}.tile.cloudmade.com/744d221a8986462c8970d7087063bd59/997/256/{z}/{x}/{y}.png', {
        attribution: 'Map &copy Cloudmade',
        maxZoom: this.maxZoom
      }).addTo(this.map);
    };

    Map.prototype.addMarker = function(longitude, latitude) {
      return L.marker([longitude, latitude]).addTo(this.map);
    };

    return Map;

  })();

  showUserPosition = function(position) {
    return map.addMarker(position.coords.latitude, position.coords.longitude);
  };

  scrollTo = function() {
    var destination, elementClicked;
    elementClicked = $(this).attr("href");
    destination = $(elementClicked).offset().top;
    $("html:not(:animated),body:not(:animated)").animate({
      scrollTop: destination - 20
    }, 500);
    return false;
  };

  isValidEmail = function(email) {
    var emailPattern;
    emailPattern = /^([\w.-]+)@([\w.-]+)\.([a-zA-Z.]{2,6})$/i;
    if (email.match(emailPattern)) {
      return true;
    } else {
      return false;
    }
  };

  showEmailError = function(message) {
    $('label[for="email"]').append('<small class="invalid" style="display: none">' + message + '</small>');
    return $('small.invalid').slideDown('slow', function() {
      return $('label[for="email"]').css('animation', 'shake 1s');
    });
  };

  window.processNewsletterForm = function(form) {
    var email, noErrorMessage;
    email = form.elements['email'].value;
    if (isValidEmail(email)) {
      if (typeof Storage !== "undefined" && Storage !== null) {
        localStorage.email = email;
      }
      return true;
    } else {
      if ($('label[for="email"] small.invalid').length === 0) {
        noErrorMessage = true;
      }
      if (noErrorMessage) {
        showEmailError("Dit email adres is niet geldig");
      }
      return false;
    }
  };

}).call(this);
